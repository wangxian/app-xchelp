define(function(require,exports,module){var _=require("underscore");var Backbone=require("backbone");var SearchKeyDef=Backbone.Model.extend({defaults:{series_id:"",year:"",trouble_location:"",transmission:"",cc:"",score:"",is_solve:"",keyword:"",order:"",page:1},serializeURL:function(){var _validData={};_.each(this.toJSON(),function(v,k){if(v!=="")_validData[k]=v});return $.param(_validData)}});var SearchKey=new SearchKeyDef;var SearchResultListDef=Backbone.Collection.extend({url:"/seek/filterResult",resetURL:function(){this.url="/seek/filterResult?"+SearchKey.serializeURL()},initialize:function(){}});var SearchResultList=new SearchResultListDef;var SearchViewDef=Backbone.View.extend({el:"#tech-che-list",events:{"tap .load-more":"loadMore","tap .tech-list li":"showDetail"},SearchKey:SearchKey,listTemplate:_.template($("#tmpl-tech-items").html()),initialize:function(){SearchKey.on("all",function(model){SearchResultList.resetURL();$.ui.showMask("正在加载...");SearchResultList.fetch()},this);SearchResultList.on("reset",this.doSearch,this);this.page=1},doSearch:function(list){if(list.length===0){$("#tech-che-list .load-more").hide();$.ui.hideMask();$("#tech-che-list-box").html('<h5 class="no-data">暂无相关数据！</h5>');$.ui.loadContent("#tech-che-list");return false}$("#tech-che-list .load-more").hide();var _data=list.toJSON();var _html=this.listTemplate({data:_data});console.log(_data);if(this.page==1)$("#tech-che-list-box").empty();$("#tech-che-list-box").append(_html);$.ui.hideMask();if(location.hash!="#tech-che-list")$.ui.loadContent("#tech-che-list")},loadMore:function(){this.SearchKey.set("page",++this.page)},showDetail:function(e){var _e=$(e.currentTarget);var _id=_e.attr("data-id");require.async("./technical-detail",function(mod){mod.showArticle(_id)})}});module.exports=new SearchViewDef});
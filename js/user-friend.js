define(function(require,exports,module){var _=require("underscore");var Backbone=require("backbone");var store=require("store");var FollowersListModel=Backbone.Model.extend({});var FollowersListCollection=Backbone.Collection.extend({model:FollowersListModel,setPage:function(page,uid){this.url="/user/gerMyFriend?uid="+uid;return this},initialize:function(){var userinfo=store.get("userinfo");this.setPage(1,userinfo.user_id)}});var FollowersList=new FollowersListCollection;window.Followers=FollowersList;var FollowersViewDef=Backbone.View.extend({el:"#friend-list",events:{"tap #friend-list .load-more":"loadMore","tap #friend-list #friend-main li":"showDetail","touchstart #friend-list #friend-main li":"touchstart","touchend #friend-list #friend-main li":"touchcancle","touchcancle #friend-list #friend-main li":"touchcancle"},touchstart:function(e){$(e.currentTarget).addClass("touching")},touchcancle:function(e){$(e.currentTarget).removeClass("touching")},homeListTemplate:_.template($("#tmpl-friend-items").html()),initialize:function(){$.ui.showMask("正在加载好友列表...");Followers.on("reset",this.renderFollowers,this);var userinfo=store.get("userinfo");this.page=1;this.uid=userinfo.user_id;this.pull()},pull:function(){Followers.setPage(this.page++,this.uid).fetch({success:function(){$.ui.hideMask()},error:function(){$.ui.hideMask();$.ui.popup({title:"错误信息",message:"服务器异常, 或许数据解析错误，请稍候重试！",doneText:"确认",doneCallback:function(){},cancelText:"取消"})}})},renderFollowers:function(list){if(list.length===0||list.length<11){$("#friend-list .load-more").hide()}var _data=list.toJSON()[0].body.data;var _html=this.homeListTemplate({data:_data});$("#friend-main").html(_html)},loadMore:function(){this.pull()},showDetail:function(e){var _e=$(e.currentTarget);var _id=_e.attr("data-id");require.async("./user-homepage",function(mod){mod.showArticle(_id)})}});new FollowersViewDef});
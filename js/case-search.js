define(function(require,exports,module){var _=require("underscore");var Backbone=require("backbone");var store=require("store");var HotTagListDef=Backbone.Model.extend({url:"/cases/getCommonSearchKey",initialize:function(){}});var HotTagList=new HotTagListDef;var PageViewDef=Backbone.View.extend({el:"#jQUi",hotTemplate:_.template('<span style="left:<%= x %>px;top:<%= y %>px;color:<%= fontColor %>;font-size:<%= fontSize %>px"><%= tag %></span>'),RecordListTemplate:_.template($("#tmpl-cases-search-record").html()),events:{"tap #maintosearch":"loadsearch","tap .record p":"searchTag","tap #searchButton":"btnSearch"},initialize:function(){HotTagList.on("change",this.renderHotTag,this);HotTagList.fetch();this.rendSearchRecord()},loadsearch:function(){$.ui.loadContent("#case-search",false,false,"fade")},rendSearchRecord:function(){if(store.get("searchRecord")){var _html=this.RecordListTemplate({data:store.get("searchRecord")});$(".record").append(_html)}},renderHotTag:function(model){var it=this;_.each(model.toJSON().body.data,function(v,k){var _item={tag:v.keyword,x:v.x,y:v.y,fontSize:v.font_size,fontColor:v.font_color};it.$("#hot-tag-box").append(it.hotTemplate(_item))})},doSearch:function(keyword){var search=require("./case-dosearch");search.SearchKey.set({keyword:""},{silent:true});search.SearchKey.set({keyword:keyword})},searchTag:function(e){var _e=$(e.currentTarget);var _keyword=_e.text();console.log(_keyword);this.doSearch(_keyword)},btnSearch:function(){if($("#case-keyword").val()==""){$.ui.popup({title:"没输入关键词？",message:"请输入您需要搜索的关键词！",cancelText:"知道了",cancelOnly:true});return false}var _keyword=$("#case-keyword").val();if(store.get("searchRecord")){var new_keyword=store.get("searchRecord");num=store.get("searchRecord").length;new_keyword[num]=_keyword;store.set("searchRecord",new_keyword)}else{var keyword=new Array;keyword[0]=_keyword;store.set("searchRecord",keyword)}this.doSearch(_keyword)}});new PageViewDef});
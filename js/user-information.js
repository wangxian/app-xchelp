define(function(require,exports,module){var _=require("underscore");var Backbone=require("backbone");var store=require("store");var ui=require("ui");var MyinfoModel=new Backbone.Model;var UpdateUserModelDef=Backbone.Model.extend({url:"/user/updateUserInfo",notAuth:true});var UpdateUserModel=new UpdateUserModelDef;var MyInfoViewDef=Backbone.View.extend({el:"#jQUi",events:{"tap #to-base-information":"showMyInformation","touchstart #to-base-information":"touchstart","touchend #to-base-information":"touchcancle","touchcancle #to-base-information":"touchcancle","tap #to-systeminfo":"showSystemInfo","touchstart #to-systeminfo":"touchstart","touchend #to-systeminfo":"touchcancle","touchcancle #to-systeminfo":"touchcancle","tap #edit-information":"updateuserinfo","tap #to-user-information":"backuserinfo","tap #to-rules":"showRules","touchstart #to-rules":"touchstart","touchend #to-rules":"touchcancle","touchcancle #to-rules":"touchcancle","tap #to-record":"showScores","touchstart #to-record":"touchstart","touchend #to-record":"touchcancle","touchcancle #to-record":"touchcancle","tap #top-my-cases":"showMyCases","touchstart #top-my-cases":"touchstart","touchend #top-my-cases":"touchcancle","touchcancle #top-my-cases":"touchcancle","tap #top-my-seek":"showMySeeks","touchstart #top-my-seek":"touchstart","touchend #top-my-seek":"touchcancle","touchcancle #top-my-seek":"touchcancle","tap #top-my-job":"showMyJobs","touchstart #top-my-job":"touchstart","touchend #top-my-job":"touchcancle","touchcancle #top-my-job":"touchcancle","tap #top-friend-list":"showMyFriendList","touchstart #top-friend-list":"touchstart","touchend #top-friend-list":"touchcancle","touchcancle #top-friend-list":"touchcancle","tap #top-my-collection":"showMyCollection","touchstart #top-my-collection":"touchstart","touchend #top-my-collection":"touchcancle","touchcancle #top-my-collection":"touchcancle"},touchstart:function(e){$(e.currentTarget).addClass("touching")},touchcancle:function(e){$(e.currentTarget).removeClass("touching")},homeListTemplate:_.template($("#tmpl-home-items").html()),homeEditListTemplate:_.template($("#tmpl-edit-home-items").html()),inforHeaderTemplate:_.template($("#tmpl-infor-header").html()),initialize:function(){$.ui.showMask("正在加载个人信息...");MyinfoModel.on("change",this.renderMyInfo,this)},showUserInformation:function(id){MyinfoModel.url="/user/getOneUserInfo/"+id;MyinfoModel.fetch()},backuserinfo:function(){var userinfo=store.get("userinfo");MyinfoModel.url="/user/getOneUserInfo/"+userinfo.user_id;MyinfoModel.fetch()},showMyInformation:function(id){var userinfo=store.get("userinfo");MyinfoModel.url="/user/getOneUserInfo/"+userinfo.user_id;MyinfoModel.fetch()},showSystemInfo:function(){$.ui.loadContent("#system")},showRules:function(){require.async("./user-integral-rules",function(mod){mod.showRuleslist()})},showScores:function(){require.async("./user-score",function(mod){mod.showScorelist()})},showMyCases:function(){$.ui.loadContent("#my-case")},showMySeeks:function(){$.ui.loadContent("#my-help")},showMyJobs:function(){$.ui.loadContent("#my-job")},showMyFriendList:function(){$.ui.loadContent("#friend-list")},showMyCollection:function(){$.ui.loadContent("#my-collection")},renderMyInfo:function(list){$.ui.loadContent("#information");var _data=list.attributes.body.data;var _html=this.homeListTemplate({data:_data});var userinfo=store.get("userinfo");if(userinfo.user_id==_data.id)auth=1;else auth=0;var header=this.inforHeaderTemplate({data:auth});$("#header").append(header);var _edit_html=this.homeEditListTemplate({data:_data});$("#usercenter-content").html(_html);$("#edit-usercenter-content").html(_edit_html)},updateuserinfo:function(){truename=$("#edit_truename").val();tel=$("#edit_tel").val();mail=$("#edit_mail").val();intro=$("#edit_intro").val();var userinfo=store.get("userinfo");var user_id=userinfo.user_id;var updateinfo={truename:truename,tel:tel,mail:mail,intro:intro,user_id:user_id};UpdateUserModel.save(updateinfo,{error:function(model,xhr,options){ui.alert("系统错误！");ui.loading.hide()},success:function(model,response){ui.loading.hide();if(response.head.code!==200){ui.alert(response.head.msg)}else{$.ui.showMask("个人信息更新成功！");$.ui.loadContent("#information");var userinfo=store.get("userinfo");MyinfoModel.url="/user/getOneUserInfo/"+userinfo.user_id;MyinfoModel.fetch()}}})}});module.exports=new MyInfoViewDef});
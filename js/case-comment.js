define(function(require,exports,module){var _=require("underscore");var Backbone=require("backbone");var store=require("store");var CommentListCollection=Backbone.Collection.extend({setPage:function(page,cid){this.url="/cases/getPageComment?page="+page+"&cid="+cid;return this}});var CommentList=new CommentListCollection;window.CommentList=CommentList;var CommentViewDef=Backbone.View.extend({el:"#jQUi",events:{"tap #pinglun .load-more":"loadMore","tap #jumpComment":"jumpComment"},CommentListTemplate:_.template($("#tmpl-comment-list").html()),jumpComment:function(){$.ui.showMask("正在加载...");$.ui.loadContent("#pinglun");CommentList.on("reset",this.renderCommentList,this);var case_id=store.get("detailCase").article.id;this.page=1;this.cid=case_id;this.pull()},detailJumpComment:function(id){$.ui.showMask("正在加载...");$.ui.loadContent("#pinglun");CommentList.on("reset",this.renderCommentList,this);this.page=1;this.cid=id;this.pull()},pull:function(){CommentList.setPage(this.page++,this.cid).fetch({success:function(){$.ui.hideMask()},error:function(){$.ui.hideMask();$.ui.popup({title:"错误信息",message:"服务器异常, 或许数据解析错误，请稍候重试！",doneText:"确认",doneCallback:function(){},cancelText:"取消"})}})},renderCommentList:function(list){if(list.models.length===0||list.models.length<10){$("#pinglun .load-more").hide()}if(list.models.length==0){_html='<h5 class="no-data selected">暂时无人评论，快来坐沙发吧！</h5>'}else{_data=list.toJSON();var _html=this.CommentListTemplate({data:_data})}$("#case-comment-main").html(_html)},loadMore:function(){this.pull()}});module.exports=new CommentViewDef});